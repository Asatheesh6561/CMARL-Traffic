[INFO 21:37:45] main Experiment Parameters:
|                                      | HyperParameter Value                  |
|:-------------------------------------|:--------------------------------------|
| CM_selected_inner                    |                                       |
| NM_lane_embedding_size               | 32                                    |
| NM_phase_loss_weight                 | 0                                     |
| NM_phase_loss_with_replay            | False                                 |
| NM_road_predict_hidden               | 32                                    |
| NM_scale_by_lane_number              | False                                 |
| NM_volume_loss_weight                | 0                                     |
| agent                                |                                       |
| cityflow_log                         |                                       |
| config.accumulated_episodes          | 1                                     |
| config.action_selector               | epsilon_greedy                        |
| config.actor_input_seq_str           | o_la                                  |
| config.agent                         | n_rnn                                 |
| config.agent_output_type             | pi_logits                             |
| config.batch_size                    | 8                                     |
| config.batch_size_run                | 8                                     |
| config.buffer_cpu_only               | True                                  |
| config.buffer_size                   | 200                                   |
| config.checkpoint_path               |                                       |
| config.critic_input_seq_str          | o                                     |
| config.critic_type                   | maddpg_critic                         |
| config.epsilon_anneal_time           | 2000000                               |
| config.epsilon_finish                | 0.05                                  |
| config.epsilon_start                 | 1.0                                   |
| config.evaluate                      | False                                 |
| config.gamma                         | 0.985                                 |
| config.grad_norm_clip                | 5                                     |
| config.hidden_dim                    | 128                                   |
| config.learner                       | maddpg_learner                        |
| config.learner_log_interval          | 10000                                 |
| config.local_results_path            | /cmlscratch/anirudhs/cmarl_traffic    |
| config.log_interval                  | 10000                                 |
| config.lr                            | 0.0005                                |
| config.mac                           | maddpg_mac                            |
| config.mini_epochs                   | 1                                     |
| config.n_lambda                      | 51                                    |
| config.name                          | maddpg                                |
| config.obs_agent_id                  | True                                  |
| config.obs_individual_obs            | False                                 |
| config.obs_last_action               | False                                 |
| config.optim                         | Adam                                  |
| config.optim_alpha                   | 0.99                                  |
| config.optim_eps                     | 1e-05                                 |
| config.reg                           | 0.001                                 |
| config.run                           | maddpg_run                            |
| config.runner                        | episode                               |
| config.sampling_lambda_index         | 0                                     |
| config.save_model                    | False                                 |
| config.save_model_interval           | 1460000                               |
| config.save_probs                    | False                                 |
| config.save_replay                   | False                                 |
| config.standardise_returns           | False                                 |
| config.standardise_rewards           | True                                  |
| config.t_max                         | 2000000                               |
| config.target_update_interval_or_tau | 200                                   |
| config.test_greedy                   | True                                  |
| config.test_interval                 | 20000                                 |
| config.test_nepisode                 | 8                                     |
| config.use_cuda                      | True                                  |
| config.use_double_q                  | True                                  |
| config.use_individual_rewards        | True                                  |
| config.use_layer_norm                | False                                 |
| config.use_loss_normalization        | False                                 |
| config.use_mean_team_reward          | False                                 |
| config.use_n_lambda                  | False                                 |
| config.use_orthogonal                | False                                 |
| config.use_reward_normalization      | True                                  |
| config.use_sample_prob_weights       | True                                  |
| config.use_single_lambda_sampling    | False                                 |
| config.use_tensorboard               | False                                 |
| config.use_wandb                     | True                                  |
| config.visualize                     | False                                 |
| config.visualize_interval            | 500000                                |
| config.wandb_project_name            | ctraffic                              |
| config.whittle_hidden_dim            | 128                                   |
| constraint                           | green_skip                            |
| development                          | False                                 |
| enable_wandb                         | True                                  |
| env                                  | ctraffic                              |
| evaluate_interval                    | 10                                    |
| evaluate_round                       | 10                                    |
| feature_hidden_size                  | 512                                   |
| fixed_time                           | 30                                    |
| gamma                                | 0.99                                  |
| gammas                               | 0.99                                  |
| gpu_to_use                           |                                       |
| green_skip_penalty                   | 0.2                                   |
| green_time_penalty                   | 0.2                                   |
| learning_rate                        | 0.0001                                |
| log_folder                           | logs/                                 |
| log_interval                         | 100                                   |
| main                                 |                                       |
| mode                                 | train                                 |
| model                                |                                       |
| model_save_path                      |                                       |
| multi_agent                          |                                       |
| n_frames                             | 1000000                               |
| n_steps                              | 5                                     |
| name                                 | maddpg                                |
| no_cuda                              | False                                 |
| phase_skip_penalty                   | 0.2                                   |
| preload_model_file                   |                                       |
| render_steps                         | -1                                    |
| results_path                         | /cmlscratch/anirudhs/ctraffic/results |
| save_interval                        | 0                                     |
| seed                                 | 122079232                             |
| simulate_time                        | 360                                   |
| target_reward                        | 1e+100                                |
| tensorboardx_comment                 |                                       |
| test_round                           | 0                                     |
| threads                              | 16                                    |
| use_cuda                             | True                                  |
| wandb_api_key                        |                                       |
| wandb_entity_name                    | anirudh-satheesh                      |
| wandb_project_name                   | ctraffic                              |
| wandb_sync_mode                      | online                                |
| work_folder                          | ./                                    |
| wrapper_model                        |                                       |
[INFO 21:37:47] main MDP Components:
|                    | vshape   | group   | dtype         |
|:-------------------|:---------|:--------|:--------------|
| actions            | (1,)     | agents  | torch.int64   |
| actions_onehot     | (8,)     | agents  | torch.float32 |
| avail_actions      | (8,)     | agents  | torch.int32   |
| filled             | (1,)     |         | torch.int64   |
| individual_rewards | (1,)     | agents  |               |
| mean_action        | (8,)     | agents  | torch.float32 |
| obs                | 204      | agents  |               |
| probs              | (8,)     | agents  | torch.float32 |
| reward             | (1,)     |         |               |
| state              | 2448.0   |         |               |
| terminated         | (1,)     |         | torch.uint8   |
| total_reward       | (1,)     |         |               |
Input Shape: 2472
[INFO 21:37:53] main Beginning training for 2000000 timesteps
[INFO 21:45:35] main Recent Stats | t_env:      10080 | Episode:      216
agent_grad_norm:           0.0029	critic_grad_norm:         56.7009	critic_loss:               1.0562	pg_loss:                  -1.3705
q_taken_mean:              0.2448	target_mean:               0.2654	td_error_abs:              0.8738	
[INFO 21:53:07] main t_env: 20160 / 2000000
[INFO 21:53:07] main Estimated time left: 1 days, 56 minutes, 20 seconds. Time passed: 15 minutes, 14 seconds
new test result : -1254.5493275555564
[INFO 21:53:21] main Recent Stats | t_env:      20160 | Episode:      440
agent_grad_norm:           0.0016	critic_grad_norm:         41.2189	critic_loss:               0.6502	pg_loss:                  -0.4949
q_taken_mean:              0.2745	target_mean:               0.4032	td_error_abs:              0.6341	
[INFO 22:00:55] main Recent Stats | t_env:      30240 | Episode:      664
agent_grad_norm:           0.0007	critic_grad_norm:         35.6033	critic_loss:               0.5359	pg_loss:                  -0.0990
q_taken_mean:              0.4762	target_mean:               0.4779	td_error_abs:              0.5631	
[INFO 22:08:22] main t_env: 40320 / 2000000
[INFO 22:08:22] main Estimated time left: 1 days, 42 minutes, 2 seconds. Time passed: 30 minutes, 28 seconds
[INFO 22:08:38] main Recent Stats | t_env:      40320 | Episode:      888
agent_grad_norm:           0.0001	critic_grad_norm:         37.3464	critic_loss:               0.4705	pg_loss:                  -0.1955
q_taken_mean:              0.3207	target_mean:               0.4230	td_error_abs:              0.5275	
[INFO 22:16:07] main Recent Stats | t_env:      50400 | Episode:     1112
agent_grad_norm:           0.0000	critic_grad_norm:         35.0746	critic_loss:               0.4255	pg_loss:                  -0.1646
q_taken_mean:              0.3015	target_mean:               0.4045	td_error_abs:              0.4947	
[INFO 22:23:41] main t_env: 60480 / 2000000
[INFO 22:23:41] main Estimated time left: 1 days, 33 minutes, 20 seconds. Time passed: 45 minutes, 47 seconds
new test result : -1217.1911113888898
[INFO 22:23:56] main Recent Stats | t_env:      60480 | Episode:     1336
agent_grad_norm:           0.0000	critic_grad_norm:         45.4737	critic_loss:               0.3370	pg_loss:                   0.1073
q_taken_mean:              0.3776	target_mean:               0.3346	td_error_abs:              0.4673	
[INFO 22:31:22] main Recent Stats | t_env:      70560 | Episode:     1560
agent_grad_norm:           0.0000	critic_grad_norm:         47.2078	critic_loss:               0.3180	pg_loss:                  -0.3820
q_taken_mean:             -0.0192	target_mean:              -0.0511	td_error_abs:              0.4514	
[INFO 22:38:55] main t_env: 80640 / 2000000
[INFO 22:38:55] main Estimated time left: 1 days, 10 minutes, 40 seconds. Time passed: 1 hours, 1 minutes, 2 seconds
new test result : -1195.1288682500003
[INFO 22:39:10] main Recent Stats | t_env:      80640 | Episode:     1784
agent_grad_norm:           0.0000	critic_grad_norm:         49.8265	critic_loss:               0.3524	pg_loss:                  -1.3187
q_taken_mean:             -0.8511	target_mean:              -0.8252	td_error_abs:              0.4848	
[INFO 22:46:32] main Recent Stats | t_env:      90720 | Episode:     2008
agent_grad_norm:           0.0000	critic_grad_norm:         54.2581	critic_loss:               0.3465	pg_loss:                  -1.9337
q_taken_mean:             -1.4726	target_mean:              -1.5898	td_error_abs:              0.4845	
[INFO 22:54:02] main t_env: 100800 / 2000000
[INFO 22:54:02] main Estimated time left: 23 hours, 43 minutes, 19 seconds. Time passed: 1 hours, 16 minutes, 8 seconds
[INFO 22:54:17] main Recent Stats | t_env:     100800 | Episode:     2232
agent_grad_norm:           0.0000	critic_grad_norm:         56.7450	critic_loss:               0.3802	pg_loss:                  -2.9973
q_taken_mean:             -2.3522	target_mean:              -2.5272	td_error_abs:              0.5177	
[INFO 23:01:38] main Recent Stats | t_env:     110880 | Episode:     2456
agent_grad_norm:           0.0000	critic_grad_norm:         36.5657	critic_loss:               0.2810	pg_loss:                  -4.1619
q_taken_mean:             -3.5672	target_mean:              -3.5879	td_error_abs:              0.4245	
[INFO 23:08:46] main t_env: 120960 / 2000000
[INFO 23:08:46] main Estimated time left: 22 hours, 53 minutes, 18 seconds. Time passed: 1 hours, 30 minutes, 52 seconds
[INFO 23:09:00] main Recent Stats | t_env:     120960 | Episode:     2680
agent_grad_norm:           0.0000	critic_grad_norm:         41.2448	critic_loss:               0.2939	pg_loss:                  -4.9161
q_taken_mean:             -4.3518	target_mean:              -4.4658	td_error_abs:              0.4383	
[INFO 23:16:11] main Recent Stats | t_env:     131040 | Episode:     2904
agent_grad_norm:           0.0000	critic_grad_norm:         36.8629	critic_loss:               0.2299	pg_loss:                  -5.4395
q_taken_mean:             -5.0523	target_mean:              -5.1492	td_error_abs:              0.3841	
[INFO 23:23:21] main t_env: 141120 / 2000000
[INFO 23:23:21] main Estimated time left: 22 hours, 24 minutes, 50 seconds. Time passed: 1 hours, 45 minutes, 27 seconds
[INFO 23:23:36] main Recent Stats | t_env:     141120 | Episode:     3128
agent_grad_norm:           0.0000	critic_grad_norm:         26.8387	critic_loss:               0.2125	pg_loss:                  -6.1766
q_taken_mean:             -5.6750	target_mean:              -5.7153	td_error_abs:              0.3607	
[INFO 23:30:41] main Recent Stats | t_env:     151200 | Episode:     3352
agent_grad_norm:           0.0000	critic_grad_norm:         39.7222	critic_loss:               0.1990	pg_loss:                  -6.4947
q_taken_mean:             -6.1117	target_mean:              -6.1910	td_error_abs:              0.3564	
[INFO 23:37:58] main t_env: 161280 / 2000000
[INFO 23:37:58] main Estimated time left: 22 hours, 13 minutes, 4 seconds. Time passed: 2 hours, 4 seconds
[INFO 23:38:13] main Recent Stats | t_env:     161280 | Episode:     3576
agent_grad_norm:           0.0000	critic_grad_norm:         50.1840	critic_loss:               0.2777	pg_loss:                  -7.0700
q_taken_mean:             -6.6842	target_mean:              -6.6893	td_error_abs:              0.4231	
[INFO 23:45:25] main Recent Stats | t_env:     171360 | Episode:     3800
agent_grad_norm:           0.0000	critic_grad_norm:         43.4193	critic_loss:               0.2680	pg_loss:                  -7.6604
q_taken_mean:             -7.1856	target_mean:              -7.1667	td_error_abs:              0.4106	
[INFO 23:52:38] main t_env: 181440 / 2000000
[INFO 23:52:38] main Estimated time left: 22 hours, 3 minutes, 14 seconds. Time passed: 2 hours, 14 minutes, 44 seconds
[INFO 23:52:53] main Recent Stats | t_env:     181440 | Episode:     4024
agent_grad_norm:           0.0000	critic_grad_norm:         67.0497	critic_loss:               0.3319	pg_loss:                  -8.1757
q_taken_mean:             -7.6649	target_mean:              -7.5524	td_error_abs:              0.4643	
[INFO 00:00:05] main Recent Stats | t_env:     191520 | Episode:     4248
agent_grad_norm:           0.0000	critic_grad_norm:         67.1839	critic_loss:               0.3318	pg_loss:                  -8.6480
q_taken_mean:             -8.3173	target_mean:              -8.1619	td_error_abs:              0.4661	
[INFO 00:07:16] main t_env: 201600 / 2000000
[INFO 00:07:16] main Estimated time left: 21 hours, 44 minutes, 51 seconds. Time passed: 2 hours, 29 minutes, 22 seconds
[INFO 00:07:31] main Recent Stats | t_env:     201600 | Episode:     4472
agent_grad_norm:           0.0000	critic_grad_norm:         48.8430	critic_loss:               0.2863	pg_loss:                  -9.0424
q_taken_mean:             -8.8873	target_mean:              -8.6262	td_error_abs:              0.4191	
/cmlscratch/anirudhs/miniconda/envs/ctraffic/lib/python3.9/site-packages/sacred/stdout_capturing.py:179: UserWarning: tee_stdout.wait timeout. Forcibly terminating.
  warnings.warn("tee_stdout.wait timeout. Forcibly terminating.")
/cmlscratch/anirudhs/miniconda/envs/ctraffic/lib/python3.9/site-packages/sacred/stdout_capturing.py:185: UserWarning: tee_stderr.wait timeout. Forcibly terminating.
  warnings.warn("tee_stderr.wait timeout. Forcibly terminating.")
[DEBUG 00:07:54] ctraffic Stopping Heartbeat
[ERROR 00:07:54] ctraffic Failed after 2:30:11!
Traceback (most recent calls WITHOUT Sacred internals):
  File "/nfshomes/anirudhs/CMARL-Traffic/main.py", line 60, in main
    run_REGISTRY[_config["config"]["run"]](_run, config, _log)
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/run/episode_run.py", line 58, in run
    run_sequential(args=args, logger=logger)
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/run/episode_run.py", line 175, in run_sequential
    episode_batch, train_reward, train_stats = runner.run(test_mode=False)
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/runners/episode_runner.py", line 105, in run
    reward, terminated, env_info = self.env.step(actions[0].reshape(-1).cpu())
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/envs/traffic/CTrafficEnvironment.py", line 92, in step
    self._obs, reward, done, info = self._env.step(actions)
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/envs/traffic/CTrafficEnvironment.py", line 66, in step
    return self._env.step(actions)
  File "/nfshomes/anirudhs/CMARL-Traffic/MARL/envs/traffic/CTrafficEnvironment.py", line 26, in step
    observation, reward, done, info = self.env.step(action)
  File "/nfshomes/anirudhs/CMARL-Traffic/Environment/wrapper/oracle_wrapper.py", line 12, in step
    states, rewards, done, info = self.env.step(actions)
  File "/nfshomes/anirudhs/CMARL-Traffic/Environment/wrapper/flatten_wrapper.py", line 17, in step
    states, rewards, done, infos = self.env.step(actions)
  File "/nfshomes/anirudhs/CMARL-Traffic/Environment/wrapper/observation_wrapper.py", line 98, in step
    state, all_reward, done, infos = self.env.step(action)
  File "/nfshomes/anirudhs/CMARL-Traffic/Environment/cityflow_env.py", line 794, in step
    self._inner_step(action, self.config["ACTION_PATTERN"])
  File "/nfshomes/anirudhs/CMARL-Traffic/Environment/cityflow_env.py", line 858, in _inner_step
    self.eng.next_step()  # catch errors and report to above
IndexError: map::at
